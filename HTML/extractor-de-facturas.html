<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Extractor de Facturas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#2563eb', // Blue-600
            secondary: '#1e40af', // Blue-800
            sidebar: '#1e293b', // Slate-800
            accent: '#ff6b00', // Orange from login
            success: '#10b981',
          }
        }
      }
    }
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="../CSS/extractor.css">
</head>

<body class="bg-gray-100 font-sans h-screen flex overflow-hidden">

  <!-- SIDEBAR -->
  <aside id="sidebar"
    class="fixed md:relative inset-y-0 left-0 z-30 w-64 bg-sidebar text-white flex flex-col shadow-2xl transition-all duration-300 transform -translate-x-full md:translate-x-0 md:w-20 lg:w-64 origin-left">
    <!-- Logo Area -->
    <div
      class="h-20 flex items-center justify-between px-4 border-b border-gray-700 bg-black/20 overflow-hidden relative">
      <div class="flex items-center justify-center flex-1">
        <img src="../IMG/Logo_empresa_noFondo.png" alt="Logo Empresa"
          class="h-16 w-auto object-contain transition-all duration-300 logo-full">
        <i class="fas fa-eye text-2xl text-white logo-icon hidden"></i>
      </div>
      <!-- Internal Toggle for Mobile/Tablet -->
      <button id="sidebarClose" class="md:hidden text-gray-400 hover:text-white focus:outline-none absolute right-4">
        <i class="fas fa-times text-xl"></i>
      </button>
    </div>

    <!-- User Profile -->
    <div class="p-6 border-b border-gray-700">
      <div class="rounded-xl p-4 shadow-lg transform transition hover:scale-105"
        style="background-color: rgba(253, 90, 3, 1);">
        <div class="flex items-center space-x-3 mb-3">
          <div
            class="w-10 h-10 rounded-full bg-white text-orange-600 flex items-center justify-center font-bold text-xl">
            <i class="fas fa-user"></i>
          </div>
          <div>
            <h3 class="font-bold text-sm" id="userName">Usuario</h3>
            <p class="text-xs text-blue-200" id="userRole">Rol</p>
          </div>
        </div>
        <p class="text-xs text-blue-100 truncate sidebar-text" id="userEmail">email@ejemplo.com</p>
      </div>
    </div>

    <!-- Navigation -->
    <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
      <a href="#"
        class="sidebar-link flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:text-white hover:bg-gray-700 relative group">
        <i class="fas fa-home w-6 text-center"></i>
        <span class="sidebar-text">Dashboard</span>
      </a>
      <a href="#"
        class="sidebar-link flex items-center space-x-3 p-3 rounded-lg bg-gray-700 text-white shadow-md relative group">
        <i class="fas fa-file-upload w-6 text-center"></i>
        <span class="sidebar-text">Subida de Facturas</span>
      </a>
      <a href="#"
        class="sidebar-link flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:text-white hover:bg-gray-700 relative group">
        <i class="fas fa-eye w-6 text-center"></i>
        <span class="sidebar-text">Ver guías</span>
      </a>
      <a href="#"
        class="sidebar-link flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:text-white hover:bg-gray-700 relative group">
        <i class="fas fa-cloud-upload-alt w-6 text-center"></i>
        <span class="sidebar-text">Subir guías</span>
      </a>
      <a href="#"
        class="sidebar-link flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:text-white hover:bg-gray-700 relative group">
        <i class="fas fa-box w-6 text-center"></i>
        <span class="sidebar-text">Ver Productos</span>
      </a>
      <a href="#"
        class="sidebar-link flex items-center space-x-3 p-3 rounded-lg text-gray-300 hover:text-white hover:bg-gray-700 relative group">
        <i class="fas fa-chart-line w-6 text-center"></i>
        <span class="sidebar-text">Tracking ML</span>
      </a>
    </nav>

    <!-- Footer / Toggle -->
    <div class="p-4 border-t border-gray-700">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <img src="../IMG/Logo_equipo.png" alt="Alphat" class="h-6 w-auto">
          <span class="font-bold text-gray-400 text-xs">Alphat Service</span>
        </div>
        <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
          <input type="checkbox" name="toggle" id="toggle"
            class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer" />
          <label for="toggle"
            class="toggle-label block overflow-hidden h-5 rounded-full bg-gray-300 cursor-pointer"></label>
        </div>
      </div>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="flex-1 flex flex-col bg-gray-100 overflow-hidden relative">
    <!-- Background Decorative Elements -->
    <div class="absolute inset-0 z-0 opacity-10 pointer-events-none">
      <svg class="absolute top-0 right-0 w-1/2 h-full text-orange-300" fill="currentColor" viewBox="0 0 100 100"
        preserveAspectRatio="none">
        <path d="M0 100 C 20 0 50 0 100 100 Z"></path>
      </svg>
    </div>

    <!-- Header -->
    <header class="bg-white shadow-sm z-10 p-6 flex justify-between items-center relative">
      <div class="flex items-center gap-4">
        <button id="sidebarToggle"
          class="text-gray-600 hover:text-primary focus:outline-none transition-transform active:scale-95">
          <i class="fas fa-bars text-2xl"></i>
        </button>
        <h1 class="text-3xl font-bold text-gray-800">BIENVENIDO <span id="welcomeUser"
            class="text-orange-600 font-bold">{Nombre}</span>!</h1>
      </div>
      <!-- Logo removed as per request -->
    </header>

    <!-- Scrollable Content Area -->
    <div class="flex-1 overflow-y-auto p-8 relative z-10 custom-scrollbar">

      <!-- Upload Section -->
      <div class="bg-white rounded-2xl shadow-lg p-8 mb-8 relative overflow-hidden">
        <div class="absolute top-0 left-0 w-2 h-full bg-accent"></div>
        <div class="flex items-start space-x-6">
          <!-- Date Circle -->
          <div
            class="hidden md:flex flex-col items-center justify-center w-24 h-24 bg-gray-800 text-white rounded-full shadow-lg border-4 border-gray-100 z-10">
            <span class="text-2xl font-bold" id="currentDateDay">15</span>
            <span class="text-sm uppercase" id="currentDateMonth">FEB</span>
          </div>

          <div class="flex-1">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-3">
              <i class="fas fa-box-open text-amber-600"></i>
              Subida Progresiva de Facturas
            </h2>
            <p class="text-gray-500 mb-6"> </p>

            <div class="relative group">
              <input type="file" id="fileInput" multiple accept="image/*" class="hidden"
                onchange="updateFileNameDisplay()" />

              <label for="fileInput"
                class="block bg-gray-50 border-2 border-dashed border-gray-300 rounded-xl p-12 text-center hover:border-primary transition-colors cursor-pointer active:scale-[0.99] transform duration-150">
                <div class="flex flex-col items-center justify-center space-y-2">
                  <h3 class="text-2xl font-bold text-gray-700 group-hover:text-primary transition-colors">Subir archivos
                  </h3>
                  <span class="text-sm text-gray-500" id="fileNameDisplay">Sin archivos seleccionados</span>
                </div>
              </label>

              <div class="mt-6 flex justify-center max-w-xl mx-auto">
                <button id="uploadBtn" onclick="startUpload()"
                  class="text-white font-bold py-2 px-6 rounded-lg shadow-md transition transform hover:scale-105 flex items-center gap-2"
                  style="background-color: rgba(253, 90, 3, 1);">
                  <span>Enviar archivos</span>
                  <i class="fas fa-paper-plane"></i>
                </button>
              </div>

              <!-- Progress -->
              <div class="progress-container hidden mt-6 max-w-xl mx-auto" id="progressContainer">
                <div class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-300 overflow-hidden">
                  <div class="bg-primary h-2.5 rounded-full" id="progressBar" style="width: 0%"></div>
                </div>
                <div id="progressText" class="text-sm text-gray-500 mt-2">Preparando...</div>
              </div>

            </div>
          </div>
        </div>
      </div>

      <!-- Products Section -->
      <div class="bg-white rounded-2xl shadow-lg overflow-hidden flex flex-col h-[600px]">
        <!-- Fixed height for table container -->

        <!-- Toolbar -->
        <div
          class="p-4 bg-gray-50 border-b border-gray-200 flex flex-col xl:flex-row justify-between items-center gap-4">
          <!-- Tabs Container -->
          <div class="flex flex-col sm:flex-row w-full xl:w-auto gap-2 p-1 rounded-lg">
            <button id="tabPending" onclick="switchTab('pending')"
              class="px-4 py-2 rounded-lg text-sm font-bold transition-colors bg-orange-600 text-white shadow-sm w-full sm:w-auto text-center">
              Productos Pendientes por Revisión
            </button>
            <button id="tabReviewed" onclick="switchTab('reviewed')"
              class="px-4 py-2 rounded-lg text-sm font-bold transition-colors text-orange-600 hover:bg-orange-50 bg-transparent w-full sm:w-auto text-center">
              Productos Revisados
            </button>
          </div>

          <div class="flex flex-col sm:flex-row gap-4 w-full xl:w-auto items-center">
            <!-- Date Filter -->
            <div class="flex gap-2 items-center w-full sm:w-auto justify-center">
              <input type="date" id="startDateFilter" onchange="filterDates()"
                class="border border-gray-300 rounded-lg px-2 py-2 text-sm focus:ring-2 focus:ring-orange-500 outline-none w-full sm:w-auto text-gray-600">
              <span class="text-gray-400 font-bold">-</span>
              <input type="date" id="endDateFilter" onchange="filterDates()"
                class="border border-gray-300 rounded-lg px-2 py-2 text-sm focus:ring-2 focus:ring-orange-500 outline-none w-full sm:w-auto text-gray-600">
            </div>

            <!-- Search & Export -->
            <div class="flex gap-4 w-full sm:w-auto">
              <div class="relative flex-1">
                <input type="text" id="searchInput" placeholder="Buscar..."
                  class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none bg-white shadow-sm text-sm">
                <i class="fas fa-search absolute left-3 top-2.5 text-gray-400"></i>
              </div>
              <button onclick="exportVerifiedProductsToCSV()"
                class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-md transition flex items-center gap-2 whitespace-nowrap">
                <i class="fas fa-file-csv"></i>
                <span class="hidden md:inline">Exportar</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Scrollable Table Wrapper -->
        <div class="flex-1 overflow-auto custom-scrollbar relative p-0" id="productsTableContainer">
          <div class="flex items-center justify-center h-full text-gray-500 italic">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mr-3"></div>
            Cargando productos...
          </div>
        </div>
      </div>

    </div>
  </main>

  <!-- LOGIC SCRIPT (Preserved & Adapted) -->
  <script src="../JS/extractor.js"></script>
</body>

</html>